<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ballbinge for Vågsbygd</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .progress-container {
      width: 100%;
      background: #e9ecef;
      border-radius: 8px;
      margin: 1em 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.07);
      overflow: hidden;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }
    .progress-bar {
      height: 28px;
      line-height: 28px;
      background: #38b000;
      color: #fff;
      font-weight: bold;
      transition: width 0.7s cubic-bezier(0.71,0.43,0.38,0.86);
      text-align: center;
      font-size: 1rem;
      white-space: nowrap;
    }
    .donasjons-status {
      text-align: center;
      margin-bottom: 1.5em;
    }
    .vipps-form {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 1em 0;
    }
    .vipps-form input[type="number"] {
      padding: 0.5em;
      font-size: 1.1em;
      width: 120px;
      margin-right: 1em;
      margin-bottom: 0.5em;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .vipps-form input[type="text"] {
      padding: 0.5em;
      font-size: 1.1em;
      min-width: 210px;
      margin-bottom: 0.5em;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .vipps-form .cta-btn {
      min-width: 200px;
      margin-top: 0.5em;
    }
    .cta-btn[disabled] {
      background: #aaa !important;
      cursor: not-allowed;
    }
    
    /* Forhåndsdefinerte beløp-knapper */
    .amount-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin: 1em 0;
    }
    
    .amount-btn {
      background: #f8f9fa;
      border: 2px solid #007a33;
      color: #007a33;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      min-width: 80px;
    }
    
    .amount-btn:hover {
      background: #007a33;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,122,51,0.3);
    }
    
    .amount-btn.active {
      background: #007a33;
      color: white;
      box-shadow: 0 4px 8px rgba(0,122,51,0.3);
    }
    
    .custom-amount {
      margin: 1.5em 0;
    }
    
    .custom-amount label {
      display: block;
      margin-bottom: 0.5em;
      font-weight: bold;
      color: #333;
    }
    
    .vipps-btn {
      background: linear-gradient(135deg, #007a33, #00a651);
      border: none;
      padding: 15px 30px;
      font-size: 1.1em;
      box-shadow: 0 4px 15px rgba(0,122,51,0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .vipps-btn:hover {
      background: linear-gradient(135deg, #00a651, #007a33);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,122,51,0.4);
    }
    
    .vipps-icon {
      font-size: 1.2em;
    }
    
    /* Tidslinje styling */
    .tidslinje {
      background: #f8f9fa;
      padding: 60px 20px;
    }
    
    .timeline-container {
      max-width: 800px;
      margin: 0 auto;
      position: relative;
    }
    
    .timeline-container::before {
      content: '';
      position: absolute;
      left: 30px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #007a33;
    }
    
    .timeline-item {
      position: relative;
      margin-bottom: 40px;
      padding-left: 80px;
    }
    
    .timeline-marker {
      position: absolute;
      left: 20px;
      top: 0;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #007a33;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      z-index: 2;
    }
    
    .timeline-item.completed .timeline-marker {
      background: #28a745;
    }
    
    .timeline-item.current .timeline-marker {
      background: #ffc107;
      color: #333;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    .timeline-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .timeline-content h3 {
      margin: 0 0 10px 0;
      color: #007a33;
    }
    
    .timeline-date {
      color: #666;
      font-size: 0.9em;
      font-weight: bold;
    }
    
    /* Fordeler styling */
    .fordeler {
      background: #e8f5e8;
      padding: 60px 20px;
    }
    
    .benefit-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px;
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .benefit-item {
      text-align: center;
      padding: 30px 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .benefit-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .benefit-icon {
      font-size: 3em;
      margin-bottom: 15px;
    }
    
    .benefit-item h3 {
      color: #007a33;
      margin: 0 0 15px 0;
      font-size: 1.3em;
    }
    
    .benefit-item p {
      color: #666;
      line-height: 1.6;
      margin: 0;
    }
    
    /* Kart styling */
    .kart {
      background: #f0f8ff;
      padding: 60px 20px;
    }
    
    .map-container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .map-placeholder {
      background: white;
      padding: 40px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 2px dashed #007a33;
    }
    
    .map-icon {
      font-size: 4em;
      margin-bottom: 20px;
    }
    
    .map-placeholder p {
      margin: 10px 0;
      color: #333;
    }
    
    /* Forbedret donasjons-status */
    .donasjons-status h3 {
      color: #007a33;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .donation-goal {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }
    
    .goal-info, .goal-deadline {
      text-align: center;
    }
    
    .goal-label, .deadline-label {
      display: block;
      font-size: 0.9em;
      color: #666;
      margin-bottom: 5px;
    }
    
    .goal-amount, .deadline-date {
      font-weight: bold;
      color: #007a33;
      font-size: 1.1em;
    }
    
    /* Responsiv design for mindre skjermer */
    @media (max-width: 768px) {
      .donation-goal {
        flex-direction: column;
        gap: 15px;
      }
      
      .benefit-grid {
        grid-template-columns: 1fr;
      }
      
      .timeline-item {
        padding-left: 60px;
      }
      
      .timeline-container::before {
        left: 20px;
      }
      
      .timeline-marker {
        left: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- HERO -->
  <section class="hero">
    <div class="overlay"></div>
    <div class="hero-content">
      <h1>Sammen bygger vi ny ballbinge for vårt nabolag</h1>
      <p>Et trygt og inkluderende sted for lek, idrett og samlingsplass – midt i nærmiljøet.</p>
      <a href="#bidra" class="cta-btn">Støtt prosjektet</a>
    </div>
  </section>

  <!-- BAKGRUNN -->
  <section class="info" id="bakgrunn">
    <h2>Hvorfor trenger vi en ballbinge?</h2>
    <p>Ballbingen blir tilrettelagt for ulike typer ballspill som fotball, håndball, volleyball og basketball. Den vil være et sosialt og inkluderende samlingspunkt for lek, idrett og fellesskap – både i skoletiden og på fritiden.</p>
  </section>

  <!-- PROSJEKT -->
  <section class="prosjekt" id="prosjekt">
    <h2>Prosjektet</h2>
    <p>Ballbingen skal bygges ved den gammle balløkka og vil være tilgjengelig for alle. Underlaget blir kunstgress som tåler helårsbruk.</p>
    <img src="assets/minimalistiskBB.png" alt="Illustrasjon av planlagt ballbinge">
  </section>

  <!-- TIDSLINJE -->
  <section class="tidslinje" id="tidslinje">
    <h2>Prosjektets fremdrift</h2>
    <div class="timeline-container">
      <div class="timeline-item completed">
        <div class="timeline-marker">✓</div>
        <div class="timeline-content">
          <h3>Planlegging og design</h3>
          <p>Utarbeidet planer og design for ballbingen</p>
          <span class="timeline-date">Q4 2024</span>
        </div>
      </div>
      <div class="timeline-item completed">
        <div class="timeline-marker">✓</div>
        <div class="timeline-content">
          <h3>Finansiering og søknader</h3>
          <p>Innsamling av midler og søknader til kommunen</p>
          <span class="timeline-date">Q1 2025</span>
        </div>
      </div>
      <div class="timeline-item current">
        <div class="timeline-marker">●</div>
        <div class="timeline-content">
          <h3>Godkjenning og tillatelser</h3>
          <p>Venter på godkjenning fra kommunen</p>
          <span class="timeline-date">Q1 2025</span>
        </div>
      </div>
      <div class="timeline-item">
        <div class="timeline-marker">○</div>
        <div class="timeline-content">
          <h3>Byggearbeid</h3>
          <p>Start av byggearbeid og grunnarbeid</p>
          <span class="timeline-date">Q2 2025</span>
        </div>
      </div>
      <div class="timeline-item">
        <div class="timeline-marker">○</div>
        <div class="timeline-content">
          <h3>Ferdigstillelse</h3>
          <p>Ballbingen står ferdig og åpner for bruk</p>
          <span class="timeline-date">Q3 2025</span>
        </div>
      </div>
    </div>
  </section>

  <!-- FORDELER -->
  <section class="fordeler" id="fordeler">
    <h2>Hvorfor en ballbinge?</h2>
    <div class="benefit-grid">
      <div class="benefit-item">
        <div class="benefit-icon">🏃‍♂️</div>
        <h3>Fysisk aktivitet</h3>
        <p>Fremmer sunn livsstil og fysisk aktivitet for alle aldre</p>
      </div>
      <div class="benefit-item">
        <div class="benefit-icon">👥</div>
        <h3>Sosial samhandling</h3>
        <p>Skaper møteplasser og styrker naboskapet</p>
      </div>
      <div class="benefit-item">
        <div class="benefit-icon">⚽</div>
        <h3>Idrett og lek</h3>
        <p>Muligheter for organisert idrett og fritidslek</p>
      </div>
      <div class="benefit-item">
        <div class="benefit-icon">🌱</div>
        <h3>Miljøvennlig</h3>
        <p>Kunstgress som tåler helårsbruk og krever minimal vedlikehold</p>
      </div>
      <div class="benefit-item">
        <div class="benefit-icon">🛡️</div>
        <h3>Trygt miljø</h3>
        <p>Et trygt og inkluderende sted for alle i nabolaget</p>
      </div>
      <div class="benefit-item">
        <div class="benefit-icon">🏘️</div>
        <h3>Naboskap</h3>
        <p>Styrker fellesskapet og skaper stolthet for området</p>
      </div>
    </div>
  </section>

  <!-- KART -->
  <section class="kart" id="kart">
    <h2>Hvor skal ballbingen bygges?</h2>
    <p>Ballbingen skal bygges ved den gammle balløkka, midt i nabolaget for enkel tilgang for alle.</p>
    <div class="map-container">
      <div class="map-placeholder">
        <div class="map-icon">📍</div>
        <p><strong>Plassering:</strong> Ved den gammle balløkka</p>
        <p><strong>Adresse:</strong> [Adresse vil bli lagt til når kart er tilgjengelig]</p>
        <p><strong>Nærhet:</strong> Sentralt plassert for alle i nabolaget</p>
      </div>
      <!-- Her kan du legge inn ditt kart når det er klart -->
      <!-- <img src="assets/kart.png" alt="Kart som viser plassering av ballbinge"> -->
    </div>
  </section>

  <!-- FINANSIERING -->
  <section class="finansiering" id="finansiering">
    <h2>Finansiering</h2>
    <table>
      <tr><th>Kostnadselement</th><th>Beløp (NOK)</th></tr>
      <tr><td>Ballbinge inkl. underlag</td><td>200 000</td></tr>
      <tr><td>Grunnarbeid</td><td>200 000</td></tr>
      <tr><td>Lys og støydemping</td><td>100 000</td></tr>
      <tr class="sum"><td><strong>Totalt</strong></td><td><strong>500 000</strong></td></tr>
    </table>
    <p>Ditt bidrag gjør en stor forskjell!</p>
  </section>

<!-- BIDRA -->
<section class="bidra" id="bidra">
  <h2>Hvordan du kan bidra</h2>
  <p>Vil du støtte prosjektet økonomisk eller som samarbeidspartner?</p>
  <p><strong>Vipps:</strong> <span id="vipps-number">hentes…</span> (merk "Ballbinge Vågsbygd")</p>

  <div class="donasjons-status">
    <h3>Donasjonsstatus</h3>
    <div class="progress-container">
      <div id="progress-bar" class="progress-bar" style="width:0%">Laster…</div>
    </div>
    <div id="donasjon-tekst" style="margin-top:0.4em;">Samlet inn: ...</div>
    <div class="donation-goal">
      <div class="goal-info">
        <span class="goal-label">Mål:</span>
        <span class="goal-amount">500 000 kr</span>
      </div>
      <div class="goal-deadline">
        <span class="deadline-label">Målsetning:</span>
        <span class="deadline-date">Q2 2025</span>
      </div>
    </div>
  </div>

  <!-- Vipps-donasjonsskjema -->
  <form class="vipps-form" id="vippsForm" onsubmit="return handleVipps(event);">
    <label for="vippsBelop" style="margin-bottom:0.3em;">Velg beløp</label>
    
    <!-- Forhåndsdefinerte beløp -->
    <div class="amount-buttons">
      <button type="button" class="amount-btn" data-amount="100">100 kr</button>
      <button type="button" class="amount-btn" data-amount="250">250 kr</button>
      <button type="button" class="amount-btn" data-amount="500">500 kr</button>
      <button type="button" class="amount-btn" data-amount="1000">1000 kr</button>
    </div>
    
    <div class="custom-amount">
      <label for="vippsBelop">Eller skriv inn eget beløp:</label>
      <input 
        type="number" 
        id="vippsBelop" 
        min="20" 
        step="10" 
        max="50000" 
        value="200"
        required
        placeholder="Skriv beløp"
      >
    </div>
    
    <input 
      type="text"
      id="vippsMessage"
      maxlength="50"
      value="Ballbinge Vågsbygd"
      style="display:none;"
    >
    <button class="cta-btn vipps-btn" id="vippsSubmitBtn" type="submit">
      <span class="vipps-icon">📱</span>
      Støtt prosjektet med Vipps
    </button>
    
    <!-- Fallback for når Vipps ikke er tilgjengelig -->
    <div class="fallback-info" style="margin-top: 1em; font-size: 0.9em; color: #666;">
      <p>💡 <strong>Tips:</strong> Hvis Vipps ikke åpner, kan du også overføre direkte til Vipps-nummeret vist over.</p>
    </div>
  </form>

  <a href="#kontakt" class="cta-btn">Ta kontakt</a>
</section>


  <!-- KONTAKT -->
  <section class="kontakt" id="kontakt">
    <h2>Kontakt oss</h2>
    <p><strong>Velformann:</strong> [Magnar Totland]</p>
    <p>Følg oss på Facebook for oppdateringer!</p>
  </section>

  <footer>
    <p>© 2025 Rådyrveien og Rådyrstien Velforening – Ballbingeprosjektet</p>
  </footer>

  <script>
    // Hent Vipps-nummer og donasjonssum, oppdater progressbar
    let totalNok = 0, goalNok = 1, lastUpdate = 0;
    const progressBar = document.getElementById('progress-bar');
    const statusText = document.getElementById('donasjon-tekst');
    const vippsNumberEl = document.getElementById('vipps-number');
    let vippsRecipient = '';

    async function oppdaterDonasjoner() {
      try {
        const res = await fetch('/api/donations/summary');
        if (!res.ok) throw new Error("Responsfeil fra server");
        const data = await res.json();
        totalNok = data.total;
        goalNok = data.goal;
        // Oppdater progressbar
        let prosent = Math.min(100, Math.round(100 * totalNok / goalNok));
        progressBar.style.width = prosent + "%";
        progressBar.textContent = prosent + "%";
        statusText.textContent = `Samlet inn: ${totalNok.toLocaleString('no-NO')} / ${goalNok.toLocaleString('no-NO')} NOK`;
      } catch (e) {
        progressBar.textContent = "Kunne ikke hente status";
      }
    }

    // Hent Vipps-nummer fra ENV (lekkes i frontend kun formål demonstrasjon/mock)
    async function hentVippsNummer() {
      try {
        const res = await fetch('/api/vipps/recipient');
        if (!res.ok) throw new Error("Ikke funnet");
        const data = await res.json();
        vippsNumberEl.textContent = data.recipient || '123456';
        vippsRecipient = data.recipient || '123456';
      } catch {
        vippsNumberEl.textContent = '123456';
        vippsRecipient = '123456';
      }
    }

    hentVippsNummer();
    oppdaterDonasjoner();
    setInterval(oppdaterDonasjoner, 30_000);

    // Håndter forhåndsdefinerte beløp-knapper
    document.addEventListener('DOMContentLoaded', function() {
      const amountButtons = document.querySelectorAll('.amount-btn');
      const amountInput = document.getElementById('vippsBelop');
      
      amountButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Fjern active-klasse fra alle knapper
          amountButtons.forEach(btn => btn.classList.remove('active'));
          // Legg til active-klasse på valgt knapp
          this.classList.add('active');
          // Oppdater input-feltet
          amountInput.value = this.dataset.amount;
        });
      });
      
      // Håndter endringer i input-feltet
      amountInput.addEventListener('input', function() {
        // Fjern active-klasse fra alle knapper når bruker skriver eget beløp
        amountButtons.forEach(btn => btn.classList.remove('active'));
      });
    });

    // Vipps-knapp-flyt
    async function handleVipps(e) {
      e.preventDefault();
      const belop = document.getElementById('vippsBelop').value;
      const melding = document.getElementById('vippsMessage').value;
      const btn = document.getElementById('vippsSubmitBtn');
      
      // Validering
      if (!belop || belop < 20) {
        alert('Beløpet må være minst 20 kr');
        return false;
      }
      
      btn.disabled = true; 
      btn.innerHTML = '<span class="vipps-icon">⏳</span> Sender...';
      
      // Simuler API-kall for testing
      setTimeout(() => {
        // Vis test-modal med Vipps-informasjon
        const testModal = document.createElement('div');
        testModal.style.cssText = `
          position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
          background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
          align-items: center; justify-content: center; font-family: Arial;
        `;
        
        testModal.innerHTML = `
          <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <h3 style="color: #007a33; margin-top: 0;">📱 Vipps Test-Modus</h3>
            <p><strong>Beløp:</strong> ${belop} kr</p>
            <p><strong>Melding:</strong> ${melding}</p>
            <p><strong>Vipps-nummer:</strong> ${vippsRecipient}</p>
            <hr style="margin: 20px 0;">
            <p style="color: #666; font-size: 0.9em;">
              💡 I produksjon vil dette åpne Vipps-appen direkte
            </p>
            <button onclick="this.parentElement.parentElement.remove()" 
                    style="background: #007a33; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-top: 15px;">
              Lukk
            </button>
          </div>
        `;
        
        document.body.appendChild(testModal);
        
        // Lukk modal ved klikk utenfor
        testModal.addEventListener('click', (e) => {
          if (e.target === testModal) testModal.remove();
        });
        
        btn.disabled = false; 
        btn.innerHTML = '<span class="vipps-icon">📱</span> Støtt prosjektet med Vipps';
      }, 1500);
      
      return false;
    }
  </script>
</body>
</html>
