<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ballbinge for V√•gsbygd</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .progress-container {
      width: 100%;
      background: #e9ecef;
      border-radius: 8px;
      margin: 1em 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.07);
      overflow: hidden;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }
    .progress-bar {
      height: 28px;
      line-height: 28px;
      background: #38b000;
      color: #fff;
      font-weight: bold;
      transition: width 0.7s cubic-bezier(0.71,0.43,0.38,0.86);
      text-align: center;
      font-size: 1rem;
      white-space: nowrap;
    }
    .donasjons-status {
      text-align: center;
      margin-bottom: 1.5em;
    }
    .vipps-form {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 1em 0;
    }
    .vipps-form input[type="number"] {
      padding: 0.5em;
      font-size: 1.1em;
      width: 120px;
      margin-right: 1em;
      margin-bottom: 0.5em;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .vipps-form input[type="text"] {
      padding: 0.5em;
      font-size: 1.1em;
      min-width: 210px;
      margin-bottom: 0.5em;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .vipps-form .cta-btn {
      min-width: 200px;
      margin-top: 0.5em;
    }
    .cta-btn[disabled] {
      background: #aaa !important;
      cursor: not-allowed;
    }
    
    /* Forh√•ndsdefinerte bel√∏p-knapper */
    .amount-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin: 1em 0;
    }
    
    .amount-btn {
      background: #f8f9fa;
      border: 2px solid #007a33;
      color: #007a33;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      min-width: 80px;
    }
    
    .amount-btn:hover {
      background: #007a33;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,122,51,0.3);
    }
    
    .amount-btn.active {
      background: #007a33;
      color: white;
      box-shadow: 0 4px 8px rgba(0,122,51,0.3);
    }
    
    .custom-amount {
      margin: 1.5em 0;
    }
    
    .custom-amount label {
      display: block;
      margin-bottom: 0.5em;
      font-weight: bold;
      color: #333;
    }
    
    .vipps-btn {
      background: linear-gradient(135deg, #007a33, #00a651);
      border: none;
      padding: 15px 30px;
      font-size: 1.1em;
      box-shadow: 0 4px 15px rgba(0,122,51,0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .vipps-btn:hover {
      background: linear-gradient(135deg, #00a651, #007a33);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,122,51,0.4);
    }
    
    .vipps-icon {
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <!-- HERO -->
  <section class="hero">
    <div class="overlay"></div>
    <div class="hero-content">
      <h1>Sammen bygger vi ny ballbinge for v√•rt nabolag</h1>
      <p>Et trygt og inkluderende sted for lek, idrett og samlingsplass ‚Äì midt i n√¶rmilj√∏et.</p>
      <a href="#bidra" class="cta-btn">St√∏tt prosjektet</a>
    </div>
  </section>

  <!-- BAKGRUNN -->
  <section class="info" id="bakgrunn">
    <h2>Hvorfor trenger vi en ballbinge?</h2>
    <p>Ballbingen blir tilrettelagt for ulike typer ballspill som fotball, h√•ndball, volleyball og basketball. Den vil v√¶re et sosialt og inkluderende samlingspunkt for lek, idrett og fellesskap ‚Äì b√•de i skoletiden og p√• fritiden.</p>
  </section>

  <!-- PROSJEKT -->
  <section class="prosjekt" id="prosjekt">
    <h2>Prosjektet</h2>
    <p>Ballbingen skal bygges ved den gammle ball√∏kka og vil v√¶re tilgjengelig for alle. Underlaget blir kunstgress som t√•ler hel√•rsbruk.</p>
    <img src="assets/minimalistiskBB.png" alt="Illustrasjon av planlagt ballbinge">
  </section>

  <!-- FINANSIERING -->
  <section class="finansiering" id="finansiering">
    <h2>Finansiering</h2>
    <table>
      <tr><th>Kostnadselement</th><th>Bel√∏p (NOK)</th></tr>
      <tr><td>Ballbinge inkl. underlag</td><td>200 000</td></tr>
      <tr><td>Grunnarbeid</td><td>200 000</td></tr>
      <tr><td>Lys og st√∏ydemping</td><td>100 000</td></tr>
      <tr class="sum"><td><strong>Totalt</strong></td><td><strong>500 000</strong></td></tr>
    </table>
    <p>Ditt bidrag gj√∏r en stor forskjell!</p>
  </section>

<!-- BIDRA -->
<section class="bidra" id="bidra">
  <h2>Hvordan du kan bidra</h2>
  <p>Vil du st√∏tte prosjektet √∏konomisk eller som samarbeidspartner?</p>
  <p><strong>Vipps:</strong> <span id="vipps-number">hentes‚Ä¶</span> (merk "Ballbinge V√•gsbygd")</p>

  <div class="donasjons-status">
    <div class="progress-container">
      <div id="progress-bar" class="progress-bar" style="width:0%">Laster‚Ä¶</div>
    </div>
    <div id="donasjon-tekst" style="margin-top:0.4em;">Samlet inn: ...</div>
  </div>

  <!-- Vipps-donasjonsskjema -->
  <form class="vipps-form" id="vippsForm" onsubmit="return handleVipps(event);">
    <label for="vippsBelop" style="margin-bottom:0.3em;">Velg bel√∏p</label>
    
    <!-- Forh√•ndsdefinerte bel√∏p -->
    <div class="amount-buttons">
      <button type="button" class="amount-btn" data-amount="100">100 kr</button>
      <button type="button" class="amount-btn" data-amount="250">250 kr</button>
      <button type="button" class="amount-btn" data-amount="500">500 kr</button>
      <button type="button" class="amount-btn" data-amount="1000">1000 kr</button>
    </div>
    
    <div class="custom-amount">
      <label for="vippsBelop">Eller skriv inn eget bel√∏p:</label>
      <input 
        type="number" 
        id="vippsBelop" 
        min="20" 
        step="10" 
        max="50000" 
        value="200"
        required
        placeholder="Skriv bel√∏p"
      >
    </div>
    
    <input 
      type="text"
      id="vippsMessage"
      maxlength="50"
      value="Ballbinge V√•gsbygd"
      style="display:none;"
    >
    <button class="cta-btn vipps-btn" id="vippsSubmitBtn" type="submit">
      <span class="vipps-icon">üì±</span>
      St√∏tt prosjektet med Vipps
    </button>
    
    <!-- Fallback for n√•r Vipps ikke er tilgjengelig -->
    <div class="fallback-info" style="margin-top: 1em; font-size: 0.9em; color: #666;">
      <p>üí° <strong>Tips:</strong> Hvis Vipps ikke √•pner, kan du ogs√• overf√∏re direkte til Vipps-nummeret vist over.</p>
    </div>
  </form>

  <a href="#kontakt" class="cta-btn">Ta kontakt</a>
</section>


  <!-- KONTAKT -->
  <section class="kontakt" id="kontakt">
    <h2>Kontakt oss</h2>
    <p><strong>Velformann:</strong> [Magnar Totland]</p>
    <p>F√∏lg oss p√• Facebook for oppdateringer!</p>
  </section>

  <footer>
    <p>¬© 2025 R√•dyrveien og R√•dyrstien Velforening ‚Äì Ballbingeprosjektet</p>
  </footer>

  <script>
    // Hent Vipps-nummer og donasjonssum, oppdater progressbar
    let totalNok = 0, goalNok = 1, lastUpdate = 0;
    const progressBar = document.getElementById('progress-bar');
    const statusText = document.getElementById('donasjon-tekst');
    const vippsNumberEl = document.getElementById('vipps-number');
    let vippsRecipient = '';

    async function oppdaterDonasjoner() {
      try {
        const res = await fetch('/api/donations/summary');
        if (!res.ok) throw new Error("Responsfeil fra server");
        const data = await res.json();
        totalNok = data.total;
        goalNok = data.goal;
        // Oppdater progressbar
        let prosent = Math.min(100, Math.round(100 * totalNok / goalNok));
        progressBar.style.width = prosent + "%";
        progressBar.textContent = prosent + "%";
        statusText.textContent = `Samlet inn: ${totalNok.toLocaleString('no-NO')} / ${goalNok.toLocaleString('no-NO')} NOK`;
      } catch (e) {
        progressBar.textContent = "Kunne ikke hente status";
      }
    }

    // Hent Vipps-nummer fra ENV (lekkes i frontend kun form√•l demonstrasjon/mock)
    async function hentVippsNummer() {
      try {
        const res = await fetch('/api/vipps/recipient');
        if (!res.ok) throw new Error("Ikke funnet");
        const data = await res.json();
        vippsNumberEl.textContent = data.recipient || '123456';
        vippsRecipient = data.recipient || '123456';
      } catch {
        vippsNumberEl.textContent = '123456';
        vippsRecipient = '123456';
      }
    }

    hentVippsNummer();
    oppdaterDonasjoner();
    setInterval(oppdaterDonasjoner, 30_000);

    // H√•ndter forh√•ndsdefinerte bel√∏p-knapper
    document.addEventListener('DOMContentLoaded', function() {
      const amountButtons = document.querySelectorAll('.amount-btn');
      const amountInput = document.getElementById('vippsBelop');
      
      amountButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Fjern active-klasse fra alle knapper
          amountButtons.forEach(btn => btn.classList.remove('active'));
          // Legg til active-klasse p√• valgt knapp
          this.classList.add('active');
          // Oppdater input-feltet
          amountInput.value = this.dataset.amount;
        });
      });
      
      // H√•ndter endringer i input-feltet
      amountInput.addEventListener('input', function() {
        // Fjern active-klasse fra alle knapper n√•r bruker skriver eget bel√∏p
        amountButtons.forEach(btn => btn.classList.remove('active'));
      });
    });

    // Vipps-knapp-flyt
    async function handleVipps(e) {
      e.preventDefault();
      const belop = document.getElementById('vippsBelop').value;
      const melding = document.getElementById('vippsMessage').value;
      const btn = document.getElementById('vippsSubmitBtn');
      
      // Validering
      if (!belop || belop < 20) {
        alert('Bel√∏pet m√• v√¶re minst 20 kr');
        return false;
      }
      
      btn.disabled = true; 
      btn.innerHTML = '<span class="vipps-icon">‚è≥</span> Sender...';
      
      // Simuler API-kall for testing
      setTimeout(() => {
        // Vis test-modal med Vipps-informasjon
        const testModal = document.createElement('div');
        testModal.style.cssText = `
          position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
          background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
          align-items: center; justify-content: center; font-family: Arial;
        `;
        
        testModal.innerHTML = `
          <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <h3 style="color: #007a33; margin-top: 0;">üì± Vipps Test-Modus</h3>
            <p><strong>Bel√∏p:</strong> ${belop} kr</p>
            <p><strong>Melding:</strong> ${melding}</p>
            <p><strong>Vipps-nummer:</strong> ${vippsRecipient}</p>
            <hr style="margin: 20px 0;">
            <p style="color: #666; font-size: 0.9em;">
              üí° I produksjon vil dette √•pne Vipps-appen direkte
            </p>
            <button onclick="this.parentElement.parentElement.remove()" 
                    style="background: #007a33; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-top: 15px;">
              Lukk
            </button>
          </div>
        `;
        
        document.body.appendChild(testModal);
        
        // Lukk modal ved klikk utenfor
        testModal.addEventListener('click', (e) => {
          if (e.target === testModal) testModal.remove();
        });
        
        btn.disabled = false; 
        btn.innerHTML = '<span class="vipps-icon">üì±</span> St√∏tt prosjektet med Vipps';
      }, 1500);
      
      return false;
    }
  </script>
</body>
</html>
